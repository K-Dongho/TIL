# JVM

### JVM 이란

JVM이란 Java Virtial Machine 자바 가상 머신의 약자를 따서 부르는 용어이다.
Java는 OS 에 종속적이지 않다는 특징을 가지고 있다. OS에 종속 받지 않고 실행하기 위해 OS 위에서 JVM이 자바를 실행시킨다.  
즉, 자바 프로그램 실행환경을 만들어 주는 소프트웨어이다.

---

### JVM 구성

- #### 실행 엔진 (Execution Engine)

  클래스를 실행시키는 역할이다. 클래스 로더가 런타임 데이터 영역에 `(*.class)`를 배치시키고 실행 엔진에 의해 실행된다.  
  실행 엔진은 `(*.class)`를 JVM 내부에서 기계가 실행할 수 있는 형태로 변경한다.

- #### 클래스 로더 (Class Loader)

  클래스 로더는 JVM 내로 `(*.class)`를 로드하고 링크를 통해 배치하는 작업을 수행하는 모듈이다. 런타임 시에 동적으로 `(*.class)`를 런타임 데이터 영역에 배치시킨다.

- #### 인터프리터 (Interpreter)

  런타임 시 자바 컴파일러에 의해 변환된 바이트 코드를 한 줄씩 기계어로 해석한다.
  한 줄씩 수행하기 때문에 속도가 느리다는 단점이 있다.

- #### JIT 컴파일러 (Just-In Time compiler)

  인터프리터 방식의 단점을 보완하기 위해 도입된 컴파일러이다. 인터프리터 방식으로 실행하다가 반복되는 코드들을 미리 기계어로 해석하여 캐싱을 해둡니다. 캐시에 보관되어 있기 때문에 한번 컴파일된 코드는 빠르게 수행하게 된다.

- #### 가비지 컬렉터 (Garbage Collector)

  더 이상 사용하지 않는 인스턴스를 찾아 메모리에서 삭제한다.

---

### Java 실행 과정

1. 코드가 실행되면 JVM은 OS로부터 메모리를 할당받는다. JVM은 메모리를 용도에 따라 여러 영역으로 나누어 관리한다.
2. 자바 컴파일러가 자바 소스코드`(*.java)`를 읽어들여 자바 바이트코드`(*.class)`로 변환시킨다
3. 클래스 로더를 통해 `(*.class)` 파일들을 JVM으로 로딩한다.
4. 로딩된 `(*.class)` 파일들은 실행 엔진에 의해 해석된다.
5. 해석된 `(*.class)`는 런타임 데이터 영역에 배치되어 실질적인 수행이 이루어진다.

---

### 런타임 데이터 영역 구조 (Runtime Data Area)

- #### Method Area

  모든 Thread들이 공유하는 메모리 영역이다. JVM이 시작될 때 생성되고, 클래스 로더에 의해 로드된 클래스 정보를 저장한다. 클래스의 바이트 코드, 상수, 필드, 메서드 등 클래스의 정보와 관련된 내용이 저장되는 공간이다. GC의 관리 대상이다.

- #### Heap

  모든 Thread들이 공유하는 메모리 영역이다. 객체와 배열을 저장하는 가상 메모리 공간으로 new 연산자로 생성된 객체와 배열을 저장한다. Method Area 영역에 올라온 클래스들만 객체로 생성할 수 있다. Heap 영역은 Old 영역과 Young 영역으로 나누어진다. GC의 관리 대상이다.

  - Young

    - Eden : 객체들이 최초로 생성되는 공간
    - Survivor : Eden에서 참조되는 객체들이 저장되는 공간

  - Old

    Young 영역에서 일정 시간 참조되고 있는 살아남은 객체들이 저장되는 공간

- #### Native Method Stack

  자바가 아닌 다른 언어로 작성된 코드를 위한 공간이다. 각 Thread마다 생성되며 네이티브 메서드를 위해 사용된다.

- #### PC Register

  Thread가 생성될 때마다 생기는 공간으로 Thread마다 하나씩 존재한다. Thread가 어떠한 명령을 실행하게 될지에 대한 부분으로 현재 수행 중인 JVM 명령의 주소를 갖는다.

- #### JVM Stack

  Stack Frame을 저장하는 스택으로 각각 Thread가 시작될 때 생성된다. 메서드가 수행될 때 임시로 할당되었다가 메서드를 빠져나가면 소멸된다. 메서드 안에서 사용되는 지역 변수, 매개변수, 함수 호출 내역 등이 저장된다.
