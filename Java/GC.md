# GC

### GC (Garbage Collection)

GC는 JVM 상에서 더 이상 사용되지 않는 데이터가 할당되어 있는 메모리를 해제시켜주는 장치입니다.

### GC 동작 방식

새로 생성된 객체는 Eden 영역에 위치한다. Eden 영역에서 Minor GC로부터 살아남은 객체는 Survivor 영역으로 이동된다. 이 과정을 반복하다가 계속해서 살아남아 있는 객체는 Old 영역으로 이동시킨다. Old 영역이 가득 차게 되면 Major GC를 실행하여 Old 영역의 모든 객체들을 검사하여 참조되지 않는 객체들을 삭제한다.

- Young

  - Eden : 객체들이 최초로 생성되는 공간
  - Survivor : Eden에서 참조되는 객체들이 저장되는 공간

- Old

  Young 영역에서 일정 시간 참조되고 있는 살아남은 객체들이 저장되는 공간

Young 영역에 대한 GC를 Minor GC, Old 영역에 대한 GC를 Major GC라고 부른다.

---

### GC가 삭제할 객체를 선정하는 방식

GC는 객체가 가비지인지 판별하기 위해서 reachability라는 개념을 사용한다. 어떤 객체에 유효한 참조가 있으면 reachable 로, 없으면 unreachable로 구별하고, unreachable 객체를 가비지로 간주해 GC를 수행한다.

객체는 여러 다른 객체를 참조하고, 참조된 다른 객체들도 마찬가지로 또 다른 객체들을 참조할 수 있으므로 객체들은 참조 사슬을 이룬다. 이런 상황에서 유효한 참조 여부를 파악하려면 항상 유효한 최초의 참조가 있어야 하는데 이를 객체 참조의 root set이라고 한다. Heap에 있는 객체들에 대한 참조는 다음 4가지 종류 중 하나이다.

1. Heap 내의 다른 객체에 의한 참조
2. Java 스택, 즉 Java 메서드 실행 시에 사용하는 지역 변수와 파라미터들에 의한 참조
3. 네이티브 스택, 즉 JNI(Java Native Interface)에 의해 생성된 객체에 대한 참조
4. 메서드 영역의 정적 변수에 의한 참조

2, 3, 4번은 root set으로 reachability를 판가름하는 기준이 된다.

GC가 일어나면 GC를 담당하는 Thread를 제외한 모든 Thread들은 일시적으로 정지 되게 된다. 이를 STW (Stop The World) 현상이라고 한다. GC가 빈번하게 일어나게 되면 GC가 수행될 때 모든 Thread가 정지되기 때문에 성능이 저하된다.
