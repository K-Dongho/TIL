# Index

### 인덱스 (Index)

인덱스란 데이터베이스 테이블에 대한 검색 성능의 속도를 높여주는 자료 구조이다. 특정 컬럼에 인덱스를 생성하면 해당 컬럼의 데이터들을 정렬하여 별도의 메모리 공간에 데이터의 물리적 주소와 함께 저장된다.

### 인덱스 (Index) 의 장점과 단점

- 장점

  - Where 절의 효율성

    테이블을 만들고 안에 데이터가 쌓이면 레코드는 내부적으로 순서가 없이 뒤죽박죽으로 저장된다. 이런 상황에서 Where 절에 특정 조건에 맞는 데이터들을 찾아내려면 처음부터 끝까지 읽어 검색 조건과 맞는지 비교해야 한다 (Full Table Scan). 하지만 인덱스 테이블은 데이터들이 정렬되어 저장되어 있는 특징을 가지고 있기 때문에 해당 조건에 맞는 데이터들을 빠르게 찾아 낼 수 있다.

  - Order by 절의 효율성

    Order by에 의한 Sort 과정을 피할 수 있다. Order by는 부하가 많이 걸리는 작업이지만 인덱스를 이용하면 이미 정렬되어 있기 때문에 부하를 줄일 수 있다.

  - Min, Max의 효율성

    인덱스를 이용하면 데이터가 정렬되어 있기 때문에 Full Table Scan으로 탐색하는 것이 아닌 정렬된 데이터에서 시작 값과 마지막 값으로 MIN, MAX를 효율적으로 찾을 수 있다.

- 단점

  - 인덱스의 추가관리 필요

    인덱스는 항상 최신의 데이터를 정렬된 상태로 유지해야 원하는 값을 빠르게 탐색할 수 있다. 인덱스가 적용된 테이블에 `INSERT`, ` UPDATE` ,`DELETE`가 수행된다면 계속 정렬을 해야 한다. 그리고 인덱스 테이블, 원본 테이블 두 군데의 데이터 수정 작업이 필요하고 그에 따른 부하가 발생한다.

  - 추가 저장공간 필요

    인덱스를 관리하기 위해서는 데이터베이스의 약 10%에 해당하는 저장 공간이 추가로 필요하다.

##

### 인덱스 (Index) 의 자료구조

- 해시 테이블 (Hash Table)

  해시 테이블은 Key value를 저장하는 자료구조이다. 빠른 데이터 검색을 할 때 유용하다. 해시 테이블 기반의 인덱스는 컬럼의 값으로 생성된 해시를 통해 인덱스를 구현한다. 하지만 해시 테이블은 값이 1개라도 달라지면 다른 해시값을 생성하기 때문에 범위 검색이 많이 사용되는 DB에서는 잘 사용되지 않는 자료구조이다.

- B - Tree

  해시 테이블의 범위 검색 문제 때문에 일반적으로 DB는 B Tree 자료구조를 이용해 인덱스를 저장한다.

  - B - Tree

    균형 이진 탐색 트리의 일종이다. 이진 트리를 확장해 하나의 노드가 가질 수 있는 자식 노드의 최대 숫자가 2보다 큰 트리 구조이다. 데이터가 항상 정렬된 상태로 유지 되어 있다. 각 노드가 가질 수 있는 최대 자식 수를 차수라고 한다. 차수가 M이라면 M차 B - Tree 라고 한다. 하나의 노드에 여러 데이터를 배치하게 되면서 이진 트리보다 훨씬 많은 데이터를 더 효율적으로 관리 할 수 있다.

  - B - Tree 규칙

    - 노드의 데이터수가 n이라면 자식 노드의 개수는 n+1 이어야 한다.

    - 노드 내 데이터는 반드시 정렬된 상태여야 한다.

    - 자식노드에 있는 데이터들은 부모노드의 데이터를 기준으로 작은 값은 왼쪽 서브트리에 큰값은 오른쪽 서브트리에 있어야 한다.

    - 루트노드가 자식이 있다면 2개이상의 자식을 가져야한다.

    - 리프 노드는 모두 같은 레벨에 있어야 한다.

    - 리프 노드의 데이터 수는 M보다 작아야 한다.

    - 루트노드와 리프노드를 제외한 노드들은 최대 M개부터 최소 M/2개 까지의 자식을 가질 수 있다.

- B + Tree

  B - Tree의 확장개념으로, B - Tree는 모든 노드에 데이터를 담을 수 있지만 B + Tree는 리프노드에만 데이터를 담을 수 있다. 나머지 노드들은 키 값만 가지고 있다. 그리고 리프노드끼리는 서로 연결리스트로 연결되어 있다. 풀 스캔 시 B + Tree는 리프 노드에 데이터가 모두 있고 서로 연결되어 있어 한 번의 선형탐색만 하면 되기 때문에 B - Tree에 비해 빠르다.

- B - Tree 와 B + Tree 차이

  | 구분            | B - Tree                     | B + Tree                      |
  | --------------- | ---------------------------- | ----------------------------- |
  | 데이터 저장     | 모든 노드에 데이터 저장 가능 | 리프노드에만 데이터 저장 가능 |
  | 트리의 높이     | 높음                         | 낮음                          |
  | 풀 스캔시 검색  | 모든 노드 탐색               | 리프노드에서 선형 탐색        |
  | 키 중복         | 없음                         | 있음                          |
  | 리프노드의 연결 | 없음                         | 링크드 리스트로 연결          |
